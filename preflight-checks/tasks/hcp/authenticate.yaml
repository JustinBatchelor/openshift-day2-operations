---
- name: task to hit hcp oauth endpoint to get token using service principal
  ansible.builtin.uri:
    url: "https://auth.idp.hashicorp.com/oauth2/token"
    method: POST
    body_format: form-urlencoded
    headers: 
      Content-Type: "application/x-www-form-urlencoded"
    body:
      client_id: "{{ clientID }}"
      client_secret: "{{ clientSecret }}"
      grant_type: "client_credentials"
      audience: "https://api.hashicorp.cloud"
    status_code: 200
    return_content: yes
  register: hcp_api_token_response

- debug:
    msg: "{{ hcp_api_token_response }}"
  when: debug_mode is true
  
- name: task to set variable for the access token returned by hcp oauth endpoint
  ansible.builtin.set_fact:
    access_token: '{{ hcp_api_token_response.json.access_token }}'

 
      